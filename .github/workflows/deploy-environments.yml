name: Deploy Multi-Branch to GitHub Pages

on:
  push:
    branches:
      - main
      - new-logo
      - arial
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main
          path: main

      - name: Checkout new-logo
        uses: actions/checkout@v4
        with:
          ref: new-logo
          path: new-logo

      - name: Checkout arial
        uses: actions/checkout@v4
        with:
          ref: arial
          path: arial

      - name: Build deployment structure
        run: |
          mkdir -p deployment

          # Main branch goes to root
          cp -r main/dist/* deployment/

          # Other branches go to subdirectories
          mkdir -p deployment/new-logo
          cp -r new-logo/dist/* deployment/new-logo/

          mkdir -p deployment/arial
          cp -r arial/dist/* deployment/arial/

          # Create index page with links to all versions
          cat > deployment/versions.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>Boston CPM - All Versions</title>
              <style>
                  body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
                  .version { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
                  .version h2 { margin-top: 0; color: #0358b5; }
                  .version a { color: #0358b5; text-decoration: none; font-weight: bold; }
                  .version a:hover { text-decoration: underline; }
              </style>
          </head>
          <body>
              <h1>Boston Commercial Property Management - All Versions</h1>

              <div class="version">
                  <h2>Production Version</h2>
                  <p>Main production website with current branding</p>
                  <a href="./" target="_blank">View Production Site →</a>
              </div>

              <div class="version">
                  <h2>New Logo Version</h2>
                  <p>Updated branding with new logo and official colors</p>
                  <a href="./new-logo/" target="_blank">View New Logo Version →</a>
              </div>

              <div class="version">
                  <h2>Arial Font Version</h2>
                  <p>New logo with Arial fonts for all text</p>
                  <a href="./arial/" target="_blank">View Arial Version →</a>
              </div>
          </body>
          </html>
          EOF

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './deployment'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4